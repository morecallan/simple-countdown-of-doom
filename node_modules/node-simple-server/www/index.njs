var util 	= require('./lib/header'),
	mysql 	= require('mysql');

var print = util.print,
	error = util.error,
	$_GET = util.get || {};

var p = parseInt($_GET['p'], 10),
	s = parseInt($_GET['s'], 10);
p = isNaN(p) || p < 1 ?  1 : p;
s = isNaN(s) || s < 1 ? 10 : s;

var handler = mysql.createConnection({
					host: 		'localhost',
					user: 		'root',
					database: 	'spac',
					password: 	require('./lib/password') 
				});
handler.connect();

console.log('<div style="text-align:center">GET 参数: ', $_GET, '</div><br/>');

handler.query('SELECT * FROM shop LIMIT '+ ((p-1)*s) +', ' + s, function (err, rows, fields) {
	if (err) throw err;

	var len = fields.length, keys = [];
	print('<div>');
	print('<table border="1px" cellspacing="0" cellpadding="8px" align="center">')
	print('<tr>');
	fields.forEach(function (field) {
		keys.push(field.name);
		print('<th>' + field.name + '</th>');
	});
	print('</tr>');
	rows.forEach(function (row) {
		print('<tr>');
		keys.forEach(function (key) {
			print('<td>' + row[key] + '</td>');
		});
		print('</tr>');
	});
	print('</table>');
	print('<br/><div class="page" style="width:100%;text-align:center;"><a href="/shop?p='+(Math.max(1, p-1))+'&s='+s+'">上一页</a>&nbsp;'
			+ '<a href="/shop?p='+(p+1)+'&s='+s+'">下一页</a></div>')
	print('</div>');

});

handler.end();